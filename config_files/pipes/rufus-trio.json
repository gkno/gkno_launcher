{
  "description" : "Compare parent and mutant strains.",
  "developmental" : true,
  "categories" : ["Reference-free"],

  "tasks" : {
    "count-mother-kmers" : {
      "tool" : "jellyfish-count"
    },
    "count-father-kmers" : {
      "tool" : "jellyfish-count"
    },
    "count-child-kmers" : {
      "tool" : "jellyfish-count"
    },


    "build-mother-histogram" : {
      "tool" : "jellyfish-histo"
    },
    "build-father-histogram" : {
      "tool" : "jellyfish-histo"
    },
    "build-child-histogram" : {
      "tool" : "jellyfish-histo"
    },


    "merge-parent-counts" : {
      "tool" : "jellyfish-merge"
    },
    "build-parents-histogram" : {
      "tool" : "jellyfish-histo"
    },


    "replace-spaces-mother" : {
      "tool" : "replace-space-tab"
    },
    "replace-spaces-father" : {
      "tool" : "replace-space-tab"
    },
    "replace-spaces-child" : {
      "tool" : "replace-space-tab"
    },
    "replace-spaces-parents" : {
      "tool" : "replace-space-tab"
    },


    "model-parents" : {
      "tool" : "rufus-model"
    },
    "model-child" : {
      "tool" : "rufus-model"
    },

    
    "dump-child-kmers" : {
      "tool" : "jellyfish-dump"
    },
    "dump-parents-kmers" : {
      "tool" : "jellyfish-dump"
    },


    "build-child-hashes" : {
      "tool" : "rufus-build-hash"
    },
    "build-parents-hashes" : {
      "tool" : "rufus-build-hash"
    }
  },

  "nodes" : [
    {
      "ID" : "mother fastq",
      "description" : "The first mate fastq file for the mother.",
      "long form argument" : "--fastq-mother",
      "short form argument" : "-qm",
      "tasks" : {
        "count-mother-kmers" : "--in"
      }
    },
    {
      "ID" : "mother fastq2",
      "description" : "The second mate fastq file for the mother.",
      "long form argument" : "--fastq-mother2",
      "short form argument" : "-qm2",
      "tasks" : {
        "count-mother-kmers" : "--in"
      }
    },
    {
      "ID" : "father fastq",
      "description" : "The first mate fastq file for the father.",
      "long form argument" : "--fastq-father",
      "short form argument" : "-qf",
      "tasks" : {
        "count-father-kmers" : "--in"
      }
    },
    {
      "ID" : "father fastq2",
      "description" : "The second mate fastq file for the father.",
      "long form argument" : "--fastq-father2",
      "short form argument" : "-qf2",
      "tasks" : {
        "count-father-kmers" : "--in"
      }
    },
    {
      "ID" : "child fastq1",
      "description" : "The first mate fastq file for the child.",
      "long form argument" : "--fastq-child",
      "short form argument" : "-qc",
      "tasks" : {
        "count-child-kmers" : "--in"
      }
    },
    {
      "ID" : "child fastq2",
      "description" : "The second mate fastq file for the child.",
      "long form argument" : "--fastq-child2",
      "short form argument" : "-qc2",
      "tasks" : {
        "count-child-kmers" : "--in"
      }
    },
    {
      "ID" : "mother output",
      "description" : "The output file from counting the mothers k-mers (default mother.jf).",
      "long form argument" : "--mother-jf",
      "short form argument" : "-mj",
      "tasks" : {
        "count-mother-kmers" : "--out",
        "build-mother-histogram" : "--in"
      },
      "greedy tasks" : {
        "merge-parent-counts" : "--in"
      }
    },
    {
      "ID" : "father output",
      "description" : "The output file from counting the fathers k-mers (default: father.jf).",
      "long form argument" : "--father-jf",
      "short form argument" : "-fj",
      "tasks" : {
        "count-father-kmers" : "--out",
        "build-father-histogram" : "--in"
      },
      "greedy tasks" : {
        "merge-parent-counts" : "--in"
      }
    },
    {
      "ID" : "child output",
      "description" : "The output file from counting the child k-mers (default: child.jf).",
      "long form argument" : "--child-jf",
      "short form argument" : "-cj",
      "tasks" : {
        "count-child-kmers" : "--out",
        "build-child-histogram" : "--in",
        "dump-child-kmers" : "--in"
      }
    },
    {
      "ID" : "k-mer length",
      "description" : "The k-mer length.",
      "long form argument" : "--k-mer",
      "short form argument" : "-k",
      "tasks" : {
        "count-mother-kmers" : "--k-mer",
        "count-father-kmers" : "--k-mer",
        "count-child-kmers" : "--k-mer",
        "model-parents" : "--k-mer",
        "model-child" : "--k-mer",
        "build-child-hashes" : "--k-mer",
        "build-parents-hashes" : "--k-mer"
      }
    },
    {
      "ID" : "initial hash size",
      "description" : "The initial hash size.",
      "long form argument" : "--size",
      "short form argument" : "-s",
      "tasks" : {
        "count-mother-kmers" : "--size",
        "count-father-kmers" : "--size",
        "count-child-kmers" : "--size"
      }
    },
    {
      "ID" : "canonical",
      "description" : "Count both strand, canonical representation (default: true).",
      "long form argument" : "--canonical",
      "short form argument" : "-ca",
      "tasks" : {
        "count-mother-kmers" : "--canonical",
        "count-father-kmers" : "--canonical",
        "count-child-kmers" : "--canonical"
      }
    },
    {
      "ID" : "threads",
      "description" : "Specifies the number of threads to use for counting k-mers.",
      "long form argument" : "--threads-k-mers",
      "short form argument" : "-tk",
      "tasks" : {
        "count-mother-kmers" : "--threads",
        "count-father-kmers" : "--threads",
        "count-child-kmers" : "--threads",
        "build-mother-histogram" : "--threads",
        "build-father-histogram" : "--threads",
        "build-child-histogram" : "--threads",
        "build-parents-histogram" : "--threads"
      }
    },
    {
      "ID" : "full",
      "description" : "Full histogram. Don't skip count 0. (default: true).",
      "long form argument" : "--full",
      "short form argument" : "-f",
      "tasks" : {
        "build-mother-histogram" : "--full",
        "build-father-histogram" : "--full",
        "build-child-histogram" : "--full",
        "build-parents-histogram" : "--full"
      }
    },
    {
      "ID" : "merged parent histogram input",
      "description" : "The merged parent k-mer counts (default: parents.jf).",
      "long form argument" : "--parents-jf",
      "short form argument" : "-pj",
      "tasks" : {
        "merge-parent-counts" : "--out",
        "build-parents-histogram" : "--in",
        "dump-parents-kmers" : "--in"
      }
    },
    {
      "ID" : "replace mother spaces.",
      "description" : "Replace spaces with tabs in mothers histogram.",
      "tasks" : {
        "build-mother-histogram" : "--out",
        "replace-spaces-mother" : "--in"
      }
    },
    {
      "ID" : "replace father spaces.",
      "description" : "Replace spaces with tabs in fathers histogram.",
      "tasks" : {
        "build-father-histogram" : "--out",
        "replace-spaces-father" : "--in"
      }
    },
    {
      "ID" : "Replace parents spaces.",
      "description" : "Replace spaces with tabs in parents histogram.",
      "tasks" : {
        "build-parents-histogram" : "--out",
        "replace-spaces-parents" : "--in"
      }
    },
    {
      "ID" : "replace child spaces.",
      "description" : "Replace spaces with tabs in child histogram.",
      "tasks" : {
        "build-child-histogram" : "--out",
        "replace-spaces-child" : "--in"
      }
    },
    {
      "ID" : "model parents",
      "description" : "model parents kmer distribution",
      "tasks" : {
        "replace-spaces-parents" : "--out",
        "model-parents" : "--in"
      }
    },
    {
      "ID" : "model child",
      "description" : "model childs kmer distribution",
      "tasks" : {
        "replace-spaces-child" : "--out",
        "model-child" : "--in"
      }
    },
    {
      "ID" : "processors rufus model",
      "description" : "The number of threads for the Rufus model step.",
      "long form argument" : "--threads-rufus-model",
      "short form argument" : "-trm",
      "tasks" : {
        "model-parents" : "--threads",
        "model-child" : "--threads"
      }
    },


    {
      "ID" : "child-lower-count",
      "description" : "Do not output k-mers with a count < lower-count for the child.",
      "long form argument" : "--child-lower-count",
      "short form argument" : "-cl",
      "tasks" : {
        "dump-child-kmers" : "--lower-count",
        "build-parents-hashes" : "--max-depth-reference"
      },
      "required" : true,
      "evaluate command" : {
        "command" : "shell head -1 FILE1",
        "add values" : [
          {
            "ID" : "FILE1",
            "task" : "model-child",
            "argument" : "--out-model"
          }
        ]
      }
    },
    {
      "ID" : "child-upper-count",
      "description" : "Do not output k-mers with count > upper-count for the child.",
      "long form argument" : "--child-upper-count",
      "short form argument" : "-cu",
      "tasks" : {
        "dump-child-kmers" : "--upper-count"
      }
    },
    {
      "ID" : "parents-lower-count",
      "description" : "Do not output k-mers with a count < lower-count for the parents.",
      "long form argument" : "--parents-lower-count",
      "short form argument" : "-pl",
      "tasks" : {
        "dump-parents-kmers" : "--lower-count",
        "build-child-hashes" : "--max-depth-reference"
      },
      "required" : true,
      "evaluate command" : {
        "command" : "shell head -1 FILE1",
        "add values" : [
          {
            "ID" : "FILE1",
            "task" : "model-parents",
            "argument" : "--out-model"
          }
        ]
      }
    },
    {
      "ID" : "parents-upper-count",
      "description" : "Do not output k-mers with count > upper-count for the parents.",
      "long form argument" : "--parents-upper-count",
      "short form argument" : "-pu",
      "tasks" : {
        "dump-child-kmers" : "--upper-count"
      }
    },
    {
      "ID" : "parents hash input",
      "description" : "Link output of dump to rufus-build-hash",
      "tasks" : {
        "dump-parents-kmers" : "--out",
        "build-parents-hashes" : "--k-mer-count2",
        "build-child-hashes" : "--k-mer-count1"
      }
    },
    {
      "ID" : "child hash input",
      "description" : "Link output of dump to rufus-build-hash",
      "tasks" : {
        "dump-child-kmers" : "--out",
        "build-child-hashes" : "--k-mer-count2",
        "build-parents-hashes" : "--k-mer-count1"
      }
    },
    {
      "ID" : "child rufus hash output",
      "description" : "Set the output file from rufus-build-hash with the child as the query strain",
      "long form argument" : "--child-hash-list",
      "short form argument" : "-ch",
      "tasks" : {
        "build-child-hashes" : "--out"
      }
    },
    {
      "ID" : "parents rufus hash output",
      "description" : "Set the output file from rufus-build-hash with the parents as the query strain",
      "long form argument" : "--parents-hash-list",
      "short form argument" : "-ph",
      "tasks" : {
        "build-parents-hashes" : "--out"
      }
    },
    {
      "ID" : "max child depth",
      "description" : "The maximum depth for the child.",
      "long form argument" : "--maximum-depth-child",
      "short form argument" : "-dc",
      "tasks" : {
        "build-child-hashes" : "--max-depth-reference"
      }
    },
    {
      "ID" : "max parent depth",
      "description" : "The maximum depth for the parents.",
      "long form argument" : "--maximum-depth-parents",
      "short form argument" : "-dp",
      "tasks" : {
        "build-parents-hashes" : "--max-depth-reference"
      }
    },
    {
      "ID" : "min child depth",
      "description" : "The minimum depth for the child.",
      "long form argument" : "--minimum-depth-child",
      "short form argument" : "-mc",
      "tasks" : {
        "build-child-hashes" : "--min-depth-query"
      },
      "required" : true,
      "evaluate command" : {
        "command" : "shell head -2 FILE1 | tail -1",
        "add values" : [
          {
            "ID" : "FILE1",
            "task" : "model-child",
            "argument" : "--out-model"
          }
        ]
      }
    },
    {
      "ID" : "min parent depth",
      "description" : "The minimum depth for the parent.",
      "long form argument" : "--minimum-depth-parent",
      "short form argument" : "-mp",
      "tasks" : {
        "build-parents-hashes" : "--min-depth-query"
      },
      "required" : true,
      "evaluate command" : {
        "command" : "shell head -2 FILE1 | tail -1",
        "add values" : [
          {
            "ID" : "FILE1",
            "task" : "model-parents",
            "argument" : "--out-model"
          }
        ]
      }
    },
    {
      "ID" : "max depth",
      "description" : "The maximum depth.",
      "long form argument" : "--max-depth",
      "short form argument" : "-d",
      "tasks" : {
        "build-parents-hashes" : "--max-depth",
        "build-child-hashes" : "--max-depth"
      }
    },
    {
      "ID" : "processors rufus build",
      "description" : "The number of threads for the Rufus build hashes step.",
      "long form argument" : "--threads-build-hash",
      "short form argument" : "-th",
      "tasks" : {
        "build-parents-hashes" : "--threads",
        "build-child-hashes" : "--threads"
      }
    }
  ],

  "parameter sets" : [
    {
      "ID" : "default",
      "description" : "Default parameter set requires user to input all input filenames.",
      "nodes" : [
        {
          "ID" : "k-mer",
          "argument" : "--k-mer",
          "values" : [23]
        },
        {
          "ID" : "hash size",
          "argument" : "--size",
          "values" : [1000000]
        },
        {
          "ID" : "canonical",
          "argument" : "--canonical",
          "values" : ["set"]
        },
        {
          "ID" : "mother-jf",
          "argument" : "--mother-jf",
          "values" : ["mother.jf"]
        },
        {
          "ID" : "father-jf",
          "argument" : "--father-jf",
          "values" : ["father.jf"]
        },
        {
          "ID" : "child-jf",
          "argument" : "--child-jf",
          "values" : ["child.jf"]
        },
        {
          "ID" : "parents-jf",
          "argument" : "--parents-jf",
          "values" : ["parents.jf"]
        },
        {
          "ID" : "threads-k-mer",
          "argument" : "--threads-k-mers",
          "values" : [8]
        },
        {
          "ID" : "full",
          "argument" : "--full",
          "values" : ["set"]
        },
        {
          "ID" : "rufus model processors",
          "argument" : "--threads-rufus-model",
          "values" : [4]
        },
        {
          "ID" : "rufus build hash processors",
          "argument" : "--threads-build-hash",
          "values" : [4]
        }
      ]
    },

    {
      "ID" : "test",
      "description" : "Test parameter set for the test harness.",
      "nodes" : [
        {
          "ID" : "mother fastq1",
          "argument" : "--fastq-mother",
          "values" : ["$(RESOURCES)/tutorial/current/mutated_genome_1.fq"]
        },
        {
          "ID" : "mother fastq2",
          "argument" : "--fastq-mother2",
          "values" : ["$(RESOURCES)/tutorial/current/mutated_genome_2.fq"]
        },
        {
          "ID" : "father fastq1",
          "argument" : "--fastq-father",
          "values" : ["$(RESOURCES)/tutorial/current/mutated_genome_set2_1.fq"]
        },
        {
          "ID" : "father fastq2",
          "argument" : "--fastq-father2",
          "values" : ["$(RESOURCES)/tutorial/current/mutated_genome_set2_2.fq"]
        },
        {
          "ID" : "child fastq1",
          "argument" : "--fastq-child",
          "values" : ["$(RESOURCES)/tutorial/current/l1_1.fq"]
        },
        {
          "ID" : "child fastq2",
          "argument" : "--fastq-child2",
          "values" : ["$(RESOURCES)/tutorial/current/l1_2.fq"]
        },
        {
          "ID" : "k-mer",
          "argument" : "--k-mer",
          "values" : [10]
        }
      ]
    }
  ]
}
