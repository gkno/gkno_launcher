{
  "id" : "glia",
  "configuration type" : "pipeline",
  "description" : "Realign a BAM file against the variant graph with glia and call variants from the realigned BAM. In addition, this pipeline feeds the VCF used for creating the variant graph to Freebayes in the calling step, to force Freebayes to consider all of the alleles when genotyping the new sample.",
  "categories" : ["Alignment", "Variant-graph"],

  "pipeline tasks" : [
    {
      "task" : "merge-bam",
      "tool" : "bamtools-merge",
      "output to stream" : true
    },
    {
      "realign",
      "tool" : "glia",
      "output to stream" : true
    },
    {
      "task" : "sort",
      "tool" : "samtools-sort",
      "output to stream" : true
    },
    {
      "task" : "call",
      "pipeline" : "freebayes"
    }
  ],

  "arguments" : {
    "Inputs" : [
      {
      "description" : "The input BAM file(s).",
      "long form argument" : "--in",
      "short form argument" : "-i",
      "node id" : "input-bam"
    },
    {
      "description" : "The genomic region for consideration.",
      "long form argument" : "--region",
      "short form argument" : "-rg",
      "required" : true,
      "node id" : "region"
    },
    {
      "description" : "The FASTA reference genome.",
      "long form argument" : "--fasta-reference",
      "short form argument" : "-r",
      "node id" : "reference"
    },
    {
      "description" : "Realign the BAM stream on stdin to the VCF file, adjusting position and flattening alignments back into the reference space where realignment to the graph provides better quality.",
      "long form argument" : "--realign-bam",
      "short form argument" : "-rb",
      "tasks" : {
        "graph-align" : "--realign-bam"
      }
    },
    {
      "description" : "Report the reverse complement if it provides a better alignment.",
      "long form argument" : "--reverse-complement",
      "short form argument" : "-rc",
      "tasks" : {
        "graph-align" : "--reverse-complement"
      }
    },
    {
      "ID" : "unsorted",
      "description" : "Do not attempt streaming sort of alignments.  This can save memory in high coverage areas, but will require sort of BAM file before it can be used for variant calling.",
      "long form argument" : "--unsorted-output",
      "short form argument" : "-u",
      "tasks" : {
        "graph-align" : "--unsorted-output"
      }
    },
    {
      "ID" : "window",
      "description" : "Number of bp of window to assemble from VCF for realignment.",
      "long form argument" : "--realignment-window",
      "short form argument" : "-rw",
      "tasks" : {
        "graph-align" : "--realignment-window"
      }
    },
    {
      "ID" : "softclip threshold",
      "description" : "If sum of qualities of soft clipped bases is >= N, realign (default ~inf).",
      "long form argument" : "--soft-clip-qsum-threshold",
      "short form argument" : "-s",
      "tasks" : {
        "graph-align" : "--soft-clip-qsum-threshold"
      }
    },
    {
      "ID" : "mismatch threshold",
      "description" : "If sum of qualities of mismatched bases is >= N, realign (default ~inf).",
      "long form argument" : "--mismatch-qsum-threshold",
      "short form argument" : "-mqt",
      "tasks" : {
        "graph-align" : "--mismatch-qsum-threshold"
      }
    },
    {
      "ID" : "gap count",
      "description" : "Accept realignment if number of gaps is < N.",
      "long form argument" : "--gap-count-max",
      "short form argument" : "-gcm",
      "tasks" : {
        "graph-align" : "--gap-count-max"
      }
    },
    {
      "ID" : "vcf",
      "description" : "The genome DAG, BGZIP'ed (.vcf.gz) and tabix-indexed (.tbi).",
      "long form argument" : "--vcf",
      "short form argument" : "-v",
      "tasks" : {
        "graph-align" : "--vcf",
        "call" : "--variant-input"
      }
    },
    {
      "ID" : "sort",
      "description" : "Pass realigned reads to Freebayes",
      "tasks" : {
        "graph-align" : "--out",
        "sort" : "--in"
      }
    },
    {
      "ID" : "stdout",
      "long form argument" : "--sort-to-stdout",
      "short form argument" : "-ss",
      "description" : "Output sorted file to stdout.",
      "tasks" : {
        "sort" : "--output-to-stdout"
      }
    },
    {
      "ID" : "pass-to-call",
      "description" : "Pass realigned reads to Freebayes",
      "tasks" : {
        "sort" : "--out",
        "call" : "--in"
      }
    },
    {
      "ID" : "combine-freebayes",
      "description" : "Combine the Freebayes VCF files.",
      "tasks" : {
        "call" : "--out"
      },
      "greedy tasks" : {
        "combine" : "--in"
      },
      "delete files" : true
    },
    {
      "ID" : "compress",
      "description" : "Compress the Freebayes VCF file.",
      "long form argument" : "--freebayes-out",
      "short form argument" : "-f",
      "tasks" : {
        "combine" : "--out",
        "compress" : "--in"
      }
    },
    {
      "ID" : "index",
      "description" : "Index the Freebayes VCF file",
      "tasks" : {
        "compress" : "--out",
        "index" : "--in"
      }
    }
  ],

  "unique graph nodes" : [
    {
      "id" : "input-bam",
      "task" : "merge-bam"
      "task argument" : "--in"
    },
    {
      "id" : "region",
      "task" : "merge-bam",
      "task argument" : "--region"
    }
  ],

  "shared graph nodes" : [
    {
      "id" : "merged-bam",
      "arguments sharing node" : [
        {
          "task" : "merge-bam",
          "argument" : "--out"
        },
        {
          "task" : "graph-align",
          "argument" : "--in"
        }
      ]
    },
    {
      "id" : "reference",
      "arguments sharing node" : [
        {
          "task" : "graph-align",
          "argument" : "--fasta-reference"
        },
        {
          "task" : "call",
          "argument" : "--fasta-reference"
        }
      ]
    }
  ],

  "parameter sets" : [
    {
      "ID" : "default",
      "description" : "The default instance sets all the parameters for the pipeline to run.",
      "nodes" : [
        {
          "ID" : "realign",
          "argument" : "--realign-bam",
          "values" : ["set"]
        },
        {
          "ID" : "reverse complement",
          "argument" : "--reverse-complement",
          "values" : ["set"]
        },
        {
          "ID" : "unsorted output",
          "argument" : "--unsorted-output",
          "values" : ["set"]
        },
        {
          "ID" : "window",
          "argument" : "--realignment-window",
          "values" : [1500]
        },
        {
          "ID" : "soft-clip",
          "argument" : "--soft-clip-qsum-threshold",
          "values" : [200]
        },
        {
          "ID" : "mismatch",
          "argument" : "--mismatch-qsum-threshold",
          "values" : [200]
        },
        {
          "ID" : "gap",
          "argument" : "--gap-count-max",
          "values" : [4]
        },
        {
          "ID" : "sort",
          "argument" : "--sort-to-stdout",
          "values" : ["set"]
        }
      ]
    },

    {
      "ID" : "human",
      "description" : "Parameter set for the human genome.",
      "nodes" : [
        {
          "ID" : "reference",
          "argument" : "--fasta-reference",
          "values" : ["$(RESOURCES)/homo_sapiens/current/human_reference_v37_decoys.fa"]
        }
      ]
    }
  ]
}
